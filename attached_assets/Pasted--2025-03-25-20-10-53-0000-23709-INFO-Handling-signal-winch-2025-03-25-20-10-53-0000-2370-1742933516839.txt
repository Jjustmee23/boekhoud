[2025-03-25 20:10:53 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:10:53 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:10:53 +0000] [23709] [INFO] Handling signal: winch
INFO:ai_document_processor:Analyzing document: static/uploads/invoice_3c8d0eed-ed1f-43d4-ba4d-7ce6deb5608e_G066688314_febb11aa1c47459c9529a2e84bc111b6.pdf
[2025-03-25 20:11:25 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:26 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:26 +0000] [23709] [INFO] Handling signal: winch
DEBUG:pytesseract:['tesseract', '/tmp/tess_is80rm9g_input.PPM', '/tmp/tess_is80rm9g', '-l', 'eng+nld', 'txt']
[2025-03-25 20:11:26 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:26 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:26 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:26 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:27 +0000] [23709] [INFO] Handling signal: winch
DEBUG:pytesseract:['tesseract', '/tmp/tess_89kftjpn_input.PPM', '/tmp/tess_89kftjpn', '-l', 'eng+nld', 'txt']
[2025-03-25 20:11:29 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:30 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:30 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:30 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:30 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:30 +0000] [23709] [INFO] Handling signal: winch
DEBUG:pytesseract:['tesseract', '/tmp/tess_3zpwninj_input.PPM', '/tmp/tess_3zpwninj', '-l', 'eng+nld', 'txt']
[2025-03-25 20:11:31 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:31 +0000] [23709] [INFO] Handling signal: winch
[2025-03-25 20:11:31 +0000] [23709] [INFO] Handling signal: winch
DEBUG:anthropic._base_client:Request options: {'method': 'post', 'url': '/v1/messages', 'timeout': Timeout(connect=5.0, read=600, write=600, pool=600), 'files': None, 'json_data': {'max_tokens': 1000, 'messages': [{'role': 'user', 'content': '\n        You are a document analyst. Analyze the following document text and identify what type of document it is.\n        \n        Document types:\n        - invoice: A bill requesting payment from a customer, containing items, prices, tax rates, etc.\n        - bank_statement: A document from a bank showing account activity, transactions, balances, etc.\n        - unknown: Any other document type\n        \n        Document text:\n        ---\n        \n--- Page 1 ---\nDE Microsoft Billing Summary\n\nMicrosoft NV/SA Summary\n\nLuchthaven Brussel Nationaal, Gebouw 1K,\n\n1930 Zaventem Billing Profile danny verheyen\nBelgium -\n\nVAT Reg. No. BE0437910359 Billing Number G066688314\nComp. Reg No.: 0437.910.359 Document Date 12/11/2024\nSold To Bill To\n\nmidaweb midaweb Total Amount EUR 24.93\nHet Vekenblok 2 Het Vekenblok 2 Due on 12/11/2024\n\nLaakdal Laakdal\n\n2430 2430 Questions on your bill? Visit https://aka.ms/invoice-billing\n\nBE BE\n\nThis invoice is for the billing period 11/11/2024 - 11/11/2024\n\nThis bill contains the charges for your purchases and services consumed from Microsoft. Find more details about your bill at\n\nhttps://admin.microsoft.com/Adminportal/Home#/billoverview/invoice-list/G066688314\n\nBilling Summary\n\nCharges 20.60\nCredits 0.00\nSubtotal 20.60\nVAT (21.00%) 433\nTotal (including Tax) EUR 24.93\n\nPayment Instructions:\n\nYour account has a credit card on file and there is no action for you to take. The card you have on file will be charged.\n\n1/3\n\n\n--- Page 2 ---\nDE Microsoft Invoice\n\nMicrosoft NV/SA Billing Profile danny verheyen\nLuchthaven Brussel Nationaal, Gebouw 1K, Tax Invoice Number BE-TI2400303010\n1930 Zaventem .\n\n. Tax Invoice Date 12/11/2024\nBelgium\n\nVAT Reg. No. BE0437910359\nComp. Reg No.: 0437.910.359\n\nSold To Bill To\n\nmidaweb midaweb\n\nHet Vekenblok 2 Het Vekenblok 2\nLaakdal Laakdal\n\n2430 2430\n\nBE BE\n\nThis invoice is for the billing period 11/11/2024 - 11/11/2024\n\nSection Summary\n\nCharges Tax Amount Total (including Tax)\nSection Name (EUR) (EUR) (EUR)\nmidaweb 20.60 433 24.93\nTotal 24.93\n\nBilling Details By Product\n\nmidaweb\n\nMicrosoft 365 Business Premium - One-Year commitment for monthly/yearly billing\n\nCharges/ Total (including\n\nPurchases Unit Price Credits Tax)\nCharge Start Date - Charge End Date (EUR) Qty (EUR) (EUR)\n11/11/2024-10/12/2024 20.60 1 20.60 24.93\nSubtotal 20.60\n\nAzure Credit 0\n\nVAT (21.00%) 433\n\nTotal EUR 24.93\n\n2/3\n\n\n--- Page 3 ---\nDE Microsoft\nPayment Instructions:\n\nYour account has a credit card on file and there is no action for you to take. The card you have on file will be charged.\n\n3/3\n\n  # Limit content to avoid exceeding context window\n        ---\n        \n        Respond in JSON format with:\n        {\n            "document_type": "invoice|bank_statement|unknown",\n            "confidence": 0.0-1.0,  # Your confidence in the identification\n            "reasoning": "brief explanation"\n        }\n        '}], 'model': 'claude-3-5-sonnet-20241022', 'system': 'You are a document analysis assistant that identifies document types accurately and responds in valid JSON format.', 'temperature': 0}}
DEBUG:anthropic._base_client:Sending HTTP Request: POST https://api.anthropic.com/v1/messages
DEBUG:httpcore.connection:connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=5.0 socket_options=[(1, 9, True), (6, 5, 60), (6, 6, 5), (6, 4, 60)]
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb446daefd0>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7fb447852690> server_hostname='api.anthropic.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb447830f50>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
[2025-03-25 20:11:33 +0000] [23709] [INFO] Handling signal: winch
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 400, b'Bad Request', [(b'Date', b'Tue, 25 Mar 2025 20:11:33 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'190'), (b'Connection', b'keep-alive'), (b'x-should-retry', b'false'), (b'request-id', b'req_01DoLyGgNxMbF4vQTfPBv5EQ'), (b'anthropic-organization-id', b'ee9b2afb-8ce2-4e82-bff8-372de147f191'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'92610edade6630b2-SEA')])
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 400 Bad Request"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:anthropic._base_client:HTTP Response: POST https://api.anthropic.com/v1/messages "400 Bad Request" Headers({'date': 'Tue, 25 Mar 2025 20:11:33 GMT', 'content-type': 'application/json', 'content-length': '190', 'connection': 'keep-alive', 'x-should-retry': 'false', 'request-id': 'req_01DoLyGgNxMbF4vQTfPBv5EQ', 'anthropic-organization-id': 'ee9b2afb-8ce2-4e82-bff8-372de147f191', 'via': '1.1 google', 'cf-cache-status': 'DYNAMIC', 'x-robots-tag': 'none', 'server': 'cloudflare', 'cf-ray': '92610edade6630b2-SEA'})
DEBUG:anthropic._base_client:request_id: req_01DoLyGgNxMbF4vQTfPBv5EQ
DEBUG:anthropic._base_client:Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/anthropic/_base_client.py", line 1096, in _request
    response.raise_for_status()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://api.anthropic.com/v1/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
DEBUG:anthropic._base_client:Not retrying as header `x-should-retry` is set to `false`
DEBUG:anthropic._base_client:Re-raising status error
ERROR:ai_document_processor:Error identifying document type: Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits.'}}
INFO:ai_document_processor:Analyzing document: static/uploads/invoice_b61a2877-b884-452e-a544-5096e30ae7ca_Invoice-2024-HS-1430.pdf
DEBUG:pytesseract:['tesseract', '/tmp/tess_cdmas8iy_input.PPM', '/tmp/tess_cdmas8iy', '-l', 'eng+nld', 'txt']
DEBUG:anthropic._base_client:Request options: {'method': 'post', 'url': '/v1/messages', 'timeout': Timeout(connect=5.0, read=600, write=600, pool=600), 'files': None, 'json_data': {'max_tokens': 1000, 'messages': [{'role': 'user', 'content': '\n        You are a document analyst. Analyze the following document text and identify what type of document it is.\n        \n        Document types:\n        - invoice: A bill requesting payment from a customer, containing items, prices, tax rates, etc.\n        - bank_statement: A document from a bank showing account activity, transactions, balances, etc.\n        - unknown: Any other document type\n        \n        Document text:\n        ---\n        \n--- Page 1 ---\n.\nÂ°\n\nHostio Solutions\nAccess2.IT Group B.V.\nCuracaostraat 11\n\n1339KL Almere\n\nNetherlands\n\nCoC: 58365400\n\nIBAN: NL21 INGB 0008 6567 95\nBIC/Swift: INGBNL2A\n\nVAT Number: NL853006404B01\n\nHO\n\nSOUOLUTI S\n\nInvoice #2024-HS-1430\n\nInvoice Date: 18-10-2024\nDue Date: 01-11-2024\n\nInvoiced To\n\nnexon solutions\n\nATTN: Danny Verheyen\n\nhet vekenblok 2\n\nlaakdal, antwerpen, 2430\nBelgium\n\nVAT Number: BE0537.664.664\n\nDescription Total\n\nDNS Manager RESELLER - NexonSolutions (01-11-2024 - 30-11-2024) â¬19.00 EUR\nDomains: 1 x Per 1000 domains â¬2.00 EUR\n\nSub Total â¬19.00 EUR\nCredit â¬0.00 EUR\nTotal â¬19.00 EUR\nTransactions\nTransaction Date Gateway Transaction ID Amount\n05-11-2024 Bank Transfer â¬19.00 EUR\nBalance â¬0.00 EUR\n\nPDF Generated on 19-01-2025\n\n  # Limit content to avoid exceeding context window\n        ---\n        \n        Respond in JSON format with:\n        {\n            "document_type": "invoice|bank_statement|unknown",\n            "confidence": 0.0-1.0,  # Your confidence in the identification\n            "reasoning": "brief explanation"\n        }\n        '}], 'model': 'claude-3-5-sonnet-20241022', 'system': 'You are a document analysis assistant that identifies document types accurately and responds in valid JSON format.', 'temperature': 0}}
DEBUG:anthropic._base_client:Sending HTTP Request: POST https://api.anthropic.com/v1/messages
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 400, b'Bad Request', [(b'Date', b'Tue, 25 Mar 2025 20:11:35 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'190'), (b'Connection', b'keep-alive'), (b'x-should-retry', b'false'), (b'request-id', b'req_014QZas8zj7r3jZKmKw6MYwR'), (b'anthropic-organization-id', b'ee9b2afb-8ce2-4e82-bff8-372de147f191'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'92610eeabdb630b2-SEA')])
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 400 Bad Request"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:anthropic._base_client:HTTP Response: POST https://api.anthropic.com/v1/messages "400 Bad Request" Headers({'date': 'Tue, 25 Mar 2025 20:11:35 GMT', 'content-type': 'application/json', 'content-length': '190', 'connection': 'keep-alive', 'x-should-retry': 'false', 'request-id': 'req_014QZas8zj7r3jZKmKw6MYwR', 'anthropic-organization-id': 'ee9b2afb-8ce2-4e82-bff8-372de147f191', 'via': '1.1 google', 'cf-cache-status': 'DYNAMIC', 'x-robots-tag': 'none', 'server': 'cloudflare', 'cf-ray': '92610eeabdb630b2-SEA'})
DEBUG:anthropic._base_client:request_id: req_014QZas8zj7r3jZKmKw6MYwR
DEBUG:anthropic._base_client:Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/anthropic/_base_client.py", line 1096, in _request
    response.raise_for_status()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://api.anthropic.com/v1/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
DEBUG:anthropic._base_client:Not retrying as header `x-should-retry` is set to `false`
DEBUG:anthropic._base_client:Re-raising status error
ERROR:ai_document_processor:Error identifying document type: Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits.'}}
INFO:ai_document_processor:Analyzing document: static/uploads/invoice_4540cb5e-292c-441d-a84b-5c8176992c15_Invoice-2024-HS-1456.pdf
DEBUG:pytesseract:['tesseract', '/tmp/tess_llksn_0g_input.PPM', '/tmp/tess_llksn_0g', '-l', 'eng+nld', 'txt']
DEBUG:anthropic._base_client:Request options: {'method': 'post', 'url': '/v1/messages', 'timeout': Timeout(connect=5.0, read=600, write=600, pool=600), 'files': None, 'json_data': {'max_tokens': 1000, 'messages': [{'role': 'user', 'content': '\n        You are a document analyst. Analyze the following document text and identify what type of document it is.\n        \n        Document types:\n        - invoice: A bill requesting payment from a customer, containing items, prices, tax rates, etc.\n        - bank_statement: A document from a bank showing account activity, transactions, balances, etc.\n        - unknown: Any other document type\n        \n        Document text:\n        ---\n        \n--- Page 1 ---\n.\nÂ°\n\nHostio Solutions\nAccess2.IT Group B.V.\nCuracaostraat 11\n\n1339KL Almere\n\nNetherlands\n\nCoC: 58365400\n\nIBAN: NL21 INGB 0008 6567 95\nBIC/Swift: INGBNL2A\n\nVAT Number: NL853006404B01\n\nHO\n\nSOUOLUTI S\n\nInvoice #2024-HS-1456\n\nInvoice Date: 16-11-2024\nDue Date: 01-12-2024\n\nInvoiced To\n\nNexon Solutions\n\nATTN: Danny Verheyen\n\nHet Vekenblok 2\n\nLaakdal, Antwerpen, 2430\nBelgium\n\nVAT Number: BE0537.664.664\n\nDescription Total\n\nDNS Manager RESELLER - NexonSolutions (01-12-2024 - 31-12-2024) â¬19.00 EUR\nDomains: 1 x Per 1000 domains â¬2.00 EUR\n\nSub Total â¬19.00 EUR\nCredit â¬0.00 EUR\nTotal â¬19.00 EUR\nTransactions\nTransaction Date Gateway Transaction ID Amount\n20-11-2024 Bank Transfer â¬19.00 EUR\nBalance â¬0.00 EUR\n\nPDF Generated on 19-01-2025\n\n  # Limit content to avoid exceeding context window\n        ---\n        \n        Respond in JSON format with:\n        {\n            "document_type": "invoice|bank_statement|unknown",\n            "confidence": 0.0-1.0,  # Your confidence in the identification\n            "reasoning": "brief explanation"\n        }\n        '}], 'model': 'claude-3-5-sonnet-20241022', 'system': 'You are a document analysis assistant that identifies document types accurately and responds in valid JSON format.', 'temperature': 0}}
DEBUG:anthropic._base_client:Sending HTTP Request: POST https://api.anthropic.com/v1/messages
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 400, b'Bad Request', [(b'Date', b'Tue, 25 Mar 2025 20:11:37 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'190'), (b'Connection', b'keep-alive'), (b'x-should-retry', b'false'), (b'request-id', b'req_01E1mEeJL5C1QVEEnUvNqZc1'), (b'anthropic-organization-id', b'ee9b2afb-8ce2-4e82-bff8-372de147f191'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'92610ef9bbc330b2-SEA')])
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 400 Bad Request"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:anthropic._base_client:HTTP Response: POST https://api.anthropic.com/v1/messages "400 Bad Request" Headers({'date': 'Tue, 25 Mar 2025 20:11:37 GMT', 'content-type': 'application/json', 'content-length': '190', 'connection': 'keep-alive', 'x-should-retry': 'false', 'request-id': 'req_01E1mEeJL5C1QVEEnUvNqZc1', 'anthropic-organization-id': 'ee9b2afb-8ce2-4e82-bff8-372de147f191', 'via': '1.1 google', 'cf-cache-status': 'DYNAMIC', 'x-robots-tag': 'none', 'server': 'cloudflare', 'cf-ray': '92610ef9bbc330b2-SEA'})
DEBUG:anthropic._base_client:request_id: req_01E1mEeJL5C1QVEEnUvNqZc1
DEBUG:anthropic._base_client:Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/anthropic/_base_client.py", line 1096, in _request
    response.raise_for_status()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://api.anthropic.com/v1/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
DEBUG:anthropic._base_client:Not retrying as header `x-should-retry` is set to `false`
DEBUG:anthropic._base_client:Re-raising status error
ERROR:ai_document_processor:Error identifying document type: Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits.'}}
INFO:ai_document_processor:Analyzing document: static/uploads/invoice_54b97fe7-c437-4d89-a43e-10720001ce9e_VF13814.pdf
DEBUG:pytesseract:['tesseract', '/tmp/tess_bh381pv3_input.PPM', '/tmp/tess_bh381pv3', '-l', 'eng+nld', 'txt']
DEBUG:anthropic._base_client:Request options: {'method': 'post', 'url': '/v1/messages', 'timeout': Timeout(connect=5.0, read=600, write=600, pool=600), 'files': None, 'json_data': {'max_tokens': 1000, 'messages': [{'role': 'user', 'content': '\n        You are a document analyst. Analyze the following document text and identify what type of document it is.\n        \n        Document types:\n        - invoice: A bill requesting payment from a customer, containing items, prices, tax rates, etc.\n        - bank_statement: A document from a bank showing account activity, transactions, balances, etc.\n        - unknown: Any other document type\n        \n        Document text:\n        ---\n        \n--- Page 1 ---\nVirtFusion Ltd\n71-75 Shelton Street, London\nWC2H 9JQ. United Kingdom\n\nINVOICE\n\nTax ID/VATIN: 397097932\nCustomer Tax ID/VATIN: BE0537.664.664\n\ndanny verheyen Invoice Number: VF13814\nmidaweb Customer Number: 2993\nhet vekenblok 2 Invoice Date: Nov 19, 2024\nlaakdal, VAN 2430 BEL Due Date: Nov 19, 2024\nDescription Quantity Unit Price Cost\nVirtFusion Web Host Edition - (Nov 19, 2024 - Dec 19, 2024) 1 $0.00 USD $0.00 USD\nL Hypervisors with 35 servers - 1x Hypervisors 1 $15.00 USD $15.00 USD\nSubtotal $15.00 USD\nTotal $15.00 USD\nPayments\nDate Applied Type Transaction Number Amount Applied\nNov 22, 2024 Credit Card ch_3QNtFHLMbyl6IhICOcCHQm88 $15.00 USD\nG\nBalance $0.00 USD\n\nPage l of 1\n\n  # Limit content to avoid exceeding context window\n        ---\n        \n        Respond in JSON format with:\n        {\n            "document_type": "invoice|bank_statement|unknown",\n            "confidence": 0.0-1.0,  # Your confidence in the identification\n            "reasoning": "brief explanation"\n        }\n        '}], 'model': 'claude-3-5-sonnet-20241022', 'system': 'You are a document analysis assistant that identifies document types accurately and responds in valid JSON format.', 'temperature': 0}}
DEBUG:anthropic._base_client:Sending HTTP Request: POST https://api.anthropic.com/v1/messages
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 400, b'Bad Request', [(b'Date', b'Tue, 25 Mar 2025 20:11:40 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'190'), (b'Connection', b'keep-alive'), (b'x-should-retry', b'false'), (b'request-id', b'req_018XLXTizecES9r3kWwfUUuy'), (b'anthropic-organization-id', b'ee9b2afb-8ce2-4e82-bff8-372de147f191'), (b'via', b'1.1 google'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'92610f090ac830b2-SEA')])
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 400 Bad Request"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:anthropic._base_client:HTTP Response: POST https://api.anthropic.com/v1/messages "400 Bad Request" Headers({'date': 'Tue, 25 Mar 2025 20:11:40 GMT', 'content-type': 'application/json', 'content-length': '190', 'connection': 'keep-alive', 'x-should-retry': 'false', 'request-id': 'req_018XLXTizecES9r3kWwfUUuy', 'anthropic-organization-id': 'ee9b2afb-8ce2-4e82-bff8-372de147f191', 'via': '1.1 google', 'cf-cache-status': 'DYNAMIC', 'x-robots-tag': 'none', 'server': 'cloudflare', 'cf-ray': '92610f090ac830b2-SEA'})
DEBUG:anthropic._base_client:request_id: req_018XLXTizecES9r3kWwfUUuy
DEBUG:anthropic._base_client:Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/anthropic/_base_client.py", line 1096, in _request
    response.raise_for_status()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://api.anthropic.com/v1/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
DEBUG:anthropic._base_client:Not retrying as header `x-should-retry` is set to `false`
DEBUG:anthropic._base_client:Re-raising status error
ERROR:ai_document_processor:Error identifying document type: Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits.'}}
INFO:ai_document_processor:Analyzing document: static/uploads/invoice_7f3b0d33-9e27-40a7-a408-90ebaaa62110_G066688314_febb11aa1c47459c9529a2e84bc111b6.pdf
DEBUG:pytesseract:['tesseract', '/tmp/tess_t63t_1uc_input.PPM', '/tmp/tess_t63t_1uc', '-l', 'eng+nld', 'txt']
DEBUG:pytesseract:['tesseract', '/tmp/tess_bg84v65o_input.PPM', '/tmp/tess_bg84v65o', '-l', 'eng+nld', 'txt']
^ADEBUG:pytesseract:['tesseract', '/tmp/tess_ci_1a2gs_input.PPM', '/tmp/tess_ci_1a2gs', '-l', 'eng+nld', 'txt']
DEBUG:anthropic._base_client:Request options: {'method': 'post', 'url': '/v1/messages', 'timeout': Timeout(connect=5.0, read=600, write=600, pool=600), 'files': None, 'json_data': {'max_tokens': 1000, 'messages': [{'role': 'user', 'content': '\n        You are a document analyst. Analyze the following document text and identify what type of document it is.\n        \n        Document types:\n        - invoice: A bill requesting payment from a customer, containing items, prices, tax rates, etc.\n        - bank_statement: A document from a bank showing account activity, transactions, balances, etc.\n        - unknown: Any other document type\n        \n        Document text:\n        ---\n        \n--- Page 1 ---\nDE Microsoft Billing Summary\n\nMicrosoft NV/SA Summary\n\nLuchthaven Brussel Nationaal, Gebouw 1K,\n\n1930 Zaventem Billing Profile danny verheyen\nBelgium -\n\nVAT Reg. No. BE0437910359 Billing Number G066688314\nComp. Reg No.: 0437.910.359 Document Date 12/11/2024\nSold To Bill To\n\nmidaweb midaweb Total Amount EUR 24.93\nHet Vekenblok 2 Het Vekenblok 2 Due on 12/11/2024\n\nLaakdal Laakdal\n\n2430 2430 Questions on your bill? Visit https://aka.ms/invoice-billing\n\nBE BE\n\nThis invoice is for the billing period 11/11/2024 - 11/11/2024\n\nThis bill contains the charges for your purchases and services consumed from Microsoft. Find more details about your bill at\n\nhttps://admin.microsoft.com/Adminportal/Home#/billoverview/invoice-list/G066688314\n\nBilling Summary\n\nCharges 20.60\nCredits 0.00\nSubtotal 20.60\nVAT (21.00%) 433\nTotal (including Tax) EUR 24.93\n\nPayment Instructions:\n\nYour account has a credit card on file and there is no action for you to take. The card you have on file will be charged.\n\n1/3\n\n\n--- Page 2 ---\nDE Microsoft Invoice\n\nMicrosoft NV/SA Billing Profile danny verheyen\nLuchthaven Brussel Nationaal, Gebouw 1K, Tax Invoice Number BE-TI2400303010\n1930 Zaventem .\n\n. Tax Invoice Date 12/11/2024\nBelgium\n\nVAT Reg. No. BE0437910359\nComp. Reg No.: 0437.910.359\n\nSold To Bill To\n\nmidaweb midaweb\n\nHet Vekenblok 2 Het Vekenblok 2\nLaakdal Laakdal\n\n2430 2430\n\nBE BE\n\nThis invoice is for the billing period 11/11/2024 - 11/11/2024\n\nSection Summary\n\nCharges Tax Amount Total (including Tax)\nSection Name (EUR) (EUR) (EUR)\nmidaweb 20.60 433 24.93\nTotal 24.93\n\nBilling Details By Product\n\nmidaweb\n\nMicrosoft 365 Business Premium - One-Year commitment for monthly/yearly billing\n\nCharges/ Total (including\n\nPurchases Unit Price Credits Tax)\nCharge Start Date - Charge End Date (EUR) Qty (EUR) (EUR)\n11/11/2024-10/12/2024 20.60 1 20.60 24.93\nSubtotal 20.60\n\nAzure Credit 0\n\nVAT (21.00%) 433\n\nTotal EUR 24.93\n\n2/3\n\n\n--- Page 3 ---\nDE Microsoft\nPayment Instructions:\n\nYour account has a credit card on file and there is no action for you to take. The card you have on file will be charged.\n\n3/3\n\n  # Limit content to avoid exceeding context window\n        ---\n        \n        Respond in JSON format with:\n        {\n            "document_type": "invoice|bank_statement|unknown",\n            "confidence": 0.0-1.0,  # Your confidence in the identification\n            "reasoning": "brief explanation"\n        }\n        '}], 'model': 'claude-3-5-sonnet-20241022', 'system': 'You are a document analysis assistant that identifies document types accurately and responds in valid JSON format.', 'temperature': 0}}
DEBUG:anthropic._base_client:Sending HTTP Request: POST https://api.anthropic.com/v1/messages
DEBUG:httpcore.connection:close.started
DEBUG:httpcore.connection:close.complete
DEBUG:httpcore.connection:connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=5.0 socket_options=[(1, 9, True), (6, 5, 60), (6, 6, 5), (6, 4, 60)]
DEBUG:httpcore.connection:connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb446df4310>
DEBUG:httpcore.connection:start_tls.started ssl_context=<ssl.SSLContext object at 0x7fb447852690> server_hostname='api.anthropic.com' timeout=5.0
DEBUG:httpcore.connection:start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7fb445417cd0>
DEBUG:httpcore.http11:send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_headers.complete
DEBUG:httpcore.http11:send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:send_request_body.complete
DEBUG:httpcore.http11:receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_headers.complete return_value=(b'HTTP/1.1', 400, b'Bad Request', [(b'Date', b'Tue, 25 Mar 2025 20:11:48 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'190'), (b'Connection', b'keep-alive'), (b'x-should-retry', b'false'), (b'request-id', b'req_018D76Pq96UYX3tTFQ2xs1WN'), (b'anthropic-organization-id', b'ee9b2afb-8ce2-4e82-bff8-372de147f191'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'92610f386aaa76df-SEA')])
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 400 Bad Request"
DEBUG:httpcore.http11:receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:receive_response_body.complete
DEBUG:httpcore.http11:response_closed.started
DEBUG:httpcore.http11:response_closed.complete
DEBUG:anthropic._base_client:HTTP Response: POST https://api.anthropic.com/v1/messages "400 Bad Request" Headers({'date': 'Tue, 25 Mar 2025 20:11:48 GMT', 'content-type': 'application/json', 'content-length': '190', 'connection': 'keep-alive', 'x-should-retry': 'false', 'request-id': 'req_018D76Pq96UYX3tTFQ2xs1WN', 'anthropic-organization-id': 'ee9b2afb-8ce2-4e82-bff8-372de147f191', 'via': '1.1 google', 'cf-cache-status': 'DYNAMIC', 'x-robots-tag': 'none', 'server': 'cloudflare', 'cf-ray': '92610f386aaa76df-SEA'})
DEBUG:anthropic._base_client:request_id: req_018D76Pq96UYX3tTFQ2xs1WN
DEBUG:anthropic._base_client:Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/anthropic/_base_client.py", line 1096, in _request
    response.raise_for_status()
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://api.anthropic.com/v1/messages'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
DEBUG:anthropic._base_client:Not retrying as header `x-should-retry` is set to `false`
DEBUG:anthropic._base_client:Re-raising status error
ERROR:ai_document_processor:Error identifying document type: Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits.'}}
INFO:ai_document_processor:Analyzing document: static/uploads/invoice_8e513cbc-8537-4c02-8a60-6fb5e70edb58_Invoice-2024-HS-1430.pdf
DEBUG:pytesseract:['tesseract', '/tmp/tess_wmco85cp_input.PPM', '/tmp/tess_wmco85cp', '-l', 'eng+nld', 'txt']