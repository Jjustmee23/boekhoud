‚úÖ Voorwaarden
Je app moet Application Permissions hebben:

Mail.Send

(optioneel) User.Read.All

De gedeelde mailbox moet bestaan (bv. noreply@jouwdomein.be)

De app moet toestemming hebben om namens die mailbox te verzenden

üß† MS Graph API-prompt (Python-script)
python
Kopi√´ren
Bewerken
import requests
from msal import ConfidentialClientApplication

# üîê Configuratie (vervang dit met jouw gegevens)
CLIENT_ID = "jouw-client-id"
CLIENT_SECRET = "jouw-client-secret"
TENANT_ID = "jouw-tenant-id"
SHARED_MAILBOX = "noreply@jouwdomein.be"  # shared mailbox adres
RECIPIENT = "klant@voorbeeld.be"         # ontvanger van de e-mail

# üì° Graph instellingen
AUTHORITY = f"https://login.microsoftonline.com/{TENANT_ID}"
SCOPE = ["https://graph.microsoft.com/.default"]
GRAPH_ENDPOINT = f"https://graph.microsoft.com/v1.0/users/{SHARED_MAILBOX}/sendMail"

# üßæ MSAL: Access Token ophalen
app = ConfidentialClientApplication(
    client_id=CLIENT_ID,
    client_credential=CLIENT_SECRET,
    authority=AUTHORITY
)

token_result = app.acquire_token_for_client(scopes=SCOPE)

if "access_token" not in token_result:
    print("‚ùå Token ophalen mislukt:")
    print(token_result.get("error_description"))
    exit(1)

# üì® E-mail opbouw
email_payload = {
    "message": {
        "subject": "Testmail via gedeelde mailbox",
        "body": {
            "contentType": "HTML",
            "content": "<b>Hallo!</b><br>Dit is een testmail verzonden via Microsoft Graph API."
        },
        "toRecipients": [
            {
                "emailAddress": {
                    "address": RECIPIENT
                }
            }
        ],
        "from": {
            "emailAddress": {
                "address": SHARED_MAILBOX
            }
        }
    },
    "saveToSentItems": "true"
}

# üöÄ Verzenden
headers = {
    "Authorization": f"Bearer {token_result['access_token']}",
    "Content-Type": "application/json"
}

response = requests.post(GRAPH_ENDPOINT, headers=headers, json=email_payload)

# ‚úÖ Logging
print(f"Statuscode: {response.status_code}")
print(response.text)
üîê Permissies in Azure instellen
Ga in Azure Portal naar jouw App > API Permissions:

Voeg toe: Mail.Send (bij voorkeur als Application Permission)

Klik op "Grant admin consent"

‚ö†Ô∏è Belangrijk
Je mag alleen verzenden vanuit een gedeelde mailbox als:

De mailbox bestaat

De app heeft rechten om namens die mailbox te verzenden

Soms via een Send As-machtiging via Exchange Admin Center

Of via Graph met juiste Application Permissions