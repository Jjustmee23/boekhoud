flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
flask_web  |     self.dialect.do_execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
flask_web  |     cursor.execute(statement, parameters)
flask_web  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column invoices.due_date does not exist
flask_web  | LINE 1: ...ices_customer_id, invoices.date AS invoices_date, invoices.d...
flask_web  |                                                              ^
flask_web  |
flask_web  | [SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.customer_id AS invoices_customer_id, invoices.date AS invoices_date, invoices.due_date AS invoices_due_date, invoices.invoice_type AS invoices_invoice_type, invoices.amount_excl_vat AS invoices_amount_excl_vat, invoices.amount_incl_vat AS invoices_amount_incl_vat, invoices.vat_rate AS invoices_vat_rate, invoices.vat_amount AS invoices_vat_amount, invoices.file_path AS invoices_file_path, invoices.status AS invoices_status, invoices.notes AS invoices_notes, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.whmcs_invoice_id AS invoices_whmcs_invoice_id, invoices.synced_from_whmcs AS invoices_synced_from_whmcs, invoices.whmcs_last_sync AS invoices_whmcs_last_sync, invoices.workspace_id AS invoices_workspace_id
flask_web  | FROM invoices
flask_web  | WHERE invoices.date >= %(date_1)s AND invoices.date <= %(date_2)s AND invoices.workspace_id = %(workspace_id_1)s]
flask_web  | [parameters: {'date_1': datetime.date(2025, 1, 1), 'date_2': datetime.date(2025, 1, 31), 'workspace_id_1': 1}]
flask_web  | (Background on this error at: https://sqlalche.me/e/20/f405)
flask_web  |
flask_web  | [2025-04-06 18:52:26 +0000] [11] [ERROR] Error handling request /
flask_web  | Traceback (most recent call last):
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
flask_web  |     self.dialect.do_execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
flask_web  |     cursor.execute(statement, parameters)
flask_web  | psycopg2.errors.UndefinedColumn: column invoices.due_date does not exist
flask_web  | LINE 1: ...ices_customer_id, invoices.date AS invoices_date, invoices.d...
flask_web  |                                                              ^
flask_web  |
flask_web  |
flask_web  | The above exception was the direct cause of the following exception:
flask_web  |
flask_web  | Traceback (most recent call last):
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/app.py", line 1511, in wsgi_app
flask_web  |     response = self.full_dispatch_request()
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/app.py", line 919, in full_dispatch_request
flask_web  |     rv = self.handle_user_exception(e)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/app.py", line 917, in full_dispatch_request
flask_web  |     rv = self.dispatch_request()
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/app.py", line 902, in dispatch_request
flask_web  |     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask_login/utils.py", line 290, in decorated_view
flask_web  |     return current_app.ensure_sync(func)(*args, **kwargs)
flask_web  |   File "/app/routes.py", line 372, in dashboard
flask_web  |     monthly_summary = get_monthly_summary(current_year, workspace_id)
flask_web  |   File "/app/models.py", line 1085, in get_monthly_summary
flask_web  |     month_invoices = query.all()
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/query.py", line 2704, in all
flask_web  |     return self._iter().all()  # type: ignore
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/query.py", line 2858, in _iter
flask_web  |     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
flask_web  |     return self._execute_internal(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
flask_web  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
flask_web  |     result = conn.execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
flask_web  |     return meth(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
flask_web  |     return connection._execute_clauseelement(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
flask_web  |     ret = self._execute_context(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
flask_web  |     return self._exec_single_context(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
flask_web  |     self._handle_dbapi_exception(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
flask_web  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
flask_web  |     self.dialect.do_execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
flask_web  |     cursor.execute(statement, parameters)
flask_web  | sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column invoices.due_date does not exist
flask_web  | LINE 1: ...ices_customer_id, invoices.date AS invoices_date, invoices.d...
flask_web  |                                                              ^
flask_web  |
flask_web  | [SQL: SELECT invoices.id AS invoices_id, invoices.invoice_number AS invoices_invoice_number, invoices.customer_id AS invoices_customer_id, invoices.date AS invoices_date, invoices.due_date AS invoices_due_date, invoices.invoice_type AS invoices_invoice_type, invoices.amount_excl_vat AS invoices_amount_excl_vat, invoices.amount_incl_vat AS invoices_amount_incl_vat, invoices.vat_rate AS invoices_vat_rate, invoices.vat_amount AS invoices_vat_amount, invoices.file_path AS invoices_file_path, invoices.status AS invoices_status, invoices.notes AS invoices_notes, invoices.created_at AS invoices_created_at, invoices.updated_at AS invoices_updated_at, invoices.whmcs_invoice_id AS invoices_whmcs_invoice_id, invoices.synced_from_whmcs AS invoices_synced_from_whmcs, invoices.whmcs_last_sync AS invoices_whmcs_last_sync, invoices.workspace_id AS invoices_workspace_id
flask_web  | FROM invoices
flask_web  | WHERE invoices.date >= %(date_1)s AND invoices.date <= %(date_2)s AND invoices.workspace_id = %(workspace_id_1)s]
flask_web  | [parameters: {'date_1': datetime.date(2025, 1, 1), 'date_2': datetime.date(2025, 1, 31), 'workspace_id_1': 1}]
flask_web  | (Background on this error at: https://sqlalche.me/e/20/f405)
flask_web  |
flask_web  | During handling of the above exception, another exception occurred:
flask_web  |
flask_web  | Traceback (most recent call last):
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
flask_web  |     self.dialect.do_execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
flask_web  |     cursor.execute(statement, parameters)
flask_web  | psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block
flask_web  |
flask_web  |
flask_web  | The above exception was the direct cause of the following exception:
flask_web  |
flask_web  | Traceback (most recent call last):
flask_web  |   File "/usr/local/lib/python3.9/site-packages/gunicorn/workers/sync.py", line 134, in handle
flask_web  |     self.handle_request(listener, req, client, addr)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/gunicorn/workers/sync.py", line 177, in handle_request
flask_web  |     respiter = self.wsgi(environ, resp.start_response)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/app.py", line 1536, in __call__
flask_web  |     return self.wsgi_app(environ, start_response)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/app.py", line 1514, in wsgi_app
flask_web  |     response = self.handle_exception(e)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/app.py", line 860, in handle_exception
flask_web  |     server_error = self.ensure_sync(handler)(server_error)
flask_web  |   File "/app/routes.py", line 4170, in internal_error
flask_web  |     return render_template('500.html', now=datetime.now()), 500
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/templating.py", line 150, in render_template
flask_web  |     return _render(app, template, context)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/flask/templating.py", line 131, in _render
flask_web  |     rv = template.render(context)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/jinja2/environment.py", line 1295, in render
flask_web  |     self.environment.handle_exception()
flask_web  |   File "/usr/local/lib/python3.9/site-packages/jinja2/environment.py", line 942, in handle_exception
flask_web  |     raise rewrite_traceback_stack(source=source)
flask_web  |   File "/app/templates/500.html", line 1, in top-level template code
flask_web  |     {% extends "base.html" %}
flask_web  |   File "/app/templates/base.html", line 98, in top-level template code
flask_web  |     {% if current_user.workspace %}
flask_web  |   File "/usr/local/lib/python3.9/site-packages/jinja2/environment.py", line 490, in getattr
flask_web  |     return getattr(obj, attribute)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
flask_web  |     return self.impl.get(state, dict_)  # type: ignore[no-any-return]
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
flask_web  |     value = self._fire_loader_callables(state, key, passive)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
flask_web  |     return self.callable_(state, passive)
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/strategies.py", line 978, in _load_for_state
flask_web  |     return self._emit_lazyload(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/strategies.py", line 1079, in _emit_lazyload
flask_web  |     return loading.load_on_pk_identity(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
flask_web  |     session.execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
flask_web  |     return self._execute_internal(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
flask_web  |     result: Result[Any] = compile_state_cls.orm_execute_statement(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
flask_web  |     result = conn.execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
flask_web  |     return meth(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
flask_web  |     return connection._execute_clauseelement(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
flask_web  |     ret = self._execute_context(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
flask_web  |     return self._exec_single_context(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
flask_web  |     self._handle_dbapi_exception(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
flask_web  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
flask_web  |     self.dialect.do_execute(
flask_web  |   File "/usr/local/lib/python3.9/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
flask_web  |     cursor.execute(statement, parameters)
flask_web  | sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block
flask_web  |
flask_web  | [SQL: SELECT workspaces.id AS workspaces_id, workspaces.name AS workspaces_name, workspaces.description AS workspaces_description, workspaces.domain AS workspaces_domain, workspaces.is_active AS workspaces_is_active, workspaces.subscription_id AS workspaces_subscription_id, workspaces.subscription_start_date AS workspaces_subscription_start_date, workspaces.subscription_end_date AS workspaces_subscription_end_date, workspaces.extra_users AS workspaces_extra_users, workspaces.billing_cycle AS workspaces_billing_cycle, workspaces.created_at AS workspaces_created_at, workspaces.updated_at AS workspaces_updated_at
flask_web  | FROM workspaces
flask_web  | WHERE workspaces.id = %(pk_1)s]
flask_web  | [parameters: {'pk_1': 1}]
flask_web  | (Background on this error at: https://sqlalche.me/e/20/2j85)
